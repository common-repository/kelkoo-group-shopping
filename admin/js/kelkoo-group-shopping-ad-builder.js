!function(e,t){t.kelkoo_group_shopping=t.kelkoo_group_shopping||{};var i=function(){};i.prototype.init=function(t,i){i=i||{},this.el=t,this.$el=e(t),this.options=i,this.nbOffersBySize={grid:{lrec:{value:3,type:"up-to"},responsive:{value:4,type:"fixed"}},dynamic:{responsive:{value:10,type:"fixed"}}};var n=this.$preview=e("#"+this.options.previewId),r=function(){return kw&&"function"==typeof kw.trigger},o=setInterval(function(){r()&&(clearInterval(o),kw.trigger("widget:setconfigs",n.data()))},100);this.$el.find("select[name=nbOffers]").change(this.changeNbOffers),this.$el.find("[data-ad-style=font]").change(this.changeFont),this.$el.find("[name=templateId]").change(e.proxy(this.changeTemplateId,this)),this.$el.find("[name=templateSize]").change(e.proxy(this.changeTemplateSize,this)),this.initColorPickers(this.$el.find("input.color-picker")),this.$el.submit(e.proxy(this.createAd,this)),this.$el.on("click blur change",function(){kelkoo_group_shopping.existingAds.closeModal()}),this.$el.children().on("click blur change",function(){kelkoo_group_shopping.existingAds.closeModal()})},i.prototype.initColorPickers=function(t){t.each(function(){var t=e(this),i=e(this).data("ad-style"),n="kw"+i.charAt(0).toUpperCase()+i.slice(1);t.ColorPicker({onSubmit:function(e,i,n,r,o){t.ColorPickerHide()},onChange:function(e,i,r){t.css({backgroundColor:"#"+i,color:"#"+i}),t.val("#"+i);var o={};o[n]=i,kw.trigger("widget:setconfigs",o)},onBeforeShow:function(){t.ColorPickerSetColor(this.value)}}).bind("keyup",function(){t.ColorPickerSetColor(this.value)})})},i.prototype.changeNbOffers=function(t){var i=e(t.currentTarget);kw.trigger("widget:setconfigs",{kwNbOffers:parseInt(i.val())})},i.prototype.changeFont=function(t){var i=e(t.currentTarget);kw.trigger("widget:setconfigs",{kwFont:i.val()})},i.prototype.changeTemplateId=function(t){var i=e(t.currentTarget),n=i.val(),r=this.$el.find("[name=templateSize]"),o=this,a=!1;r.find("option").each(function(t){o.nbOffersBySize&&o.nbOffersBySize.hasOwnProperty(n)&&o.nbOffersBySize[n].hasOwnProperty(e(this).val())?(e(this).prop("disabled",!1),a||(r.val(e(this).val()),a=!0)):e(this).prop("disabled","disabled")}),kw.trigger("widget:setconfigs",{kwTemplateId:n}),r.trigger("change",{customTarget:i})},i.prototype.changeTemplateSize=function(t){var i=e(t.currentTarget),n=i.val(),r=this.$el.find("[name=templateId]").val(),o=1,a=[1,2,3,4,10],s=a.length;if(kw.trigger("widget:setconfigs",{kwTemplateSize:i.val()}),"fixed"===this.nbOffersBySize[r][n].type){for(var l=0;l<s;l++){var f=a[l];f===this.nbOffersBySize[r][n].value?this.$el.find("select[name=nbOffers] option[value="+f+"]").removeAttr("disabled"):this.$el.find("select[name=nbOffers] option[value="+f+"]").attr("disabled","disabled")}o=this.nbOffersBySize[r][n].value}else for(var l=0;l<s;l++){var f=a[l];f<=this.nbOffersBySize[r][n].value?this.$el.find("select[name=nbOffers] option[value="+f+"]").removeAttr("disabled"):this.$el.find("select[name=nbOffers] option[value="+f+"]").attr("disabled","disabled")}this.$el.find("select[name=nbOffers]").val(o),kw.trigger("widget:setconfigs",{kwNbOffers:parseInt(o,10)}),"responsive"===n&&"dynamic"===r&&new kw.Dynamic(kw.widgets[0])},i.prototype.createAd=function(i){i.preventDefault();var n={};this.$el.find("[data-ad-style]").each(function(){var e=jQuery(this).data("ad-style");n[e]=jQuery(this).val()}),e.ajax({method:"POST",url:ajaxurl,data:{action:"kga_create_ad",adStyle:n,queryString:"?"+this.$el.serialize()}}).done(function(e){t.kelkoo_group_shopping.existingAds.add(e)}).error(function(e,t){console.log("error")})},t.kelkoo_group_shopping.AdBuilder=i}(jQuery,window);