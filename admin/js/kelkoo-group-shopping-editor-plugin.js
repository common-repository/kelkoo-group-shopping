!function(e,o){e.PluginManager.add("kelkoo_group_shopping",function(e,t){e.addButton("kelkoogroup_ad_shortcode",{title:"Insert shortcode for Kelkoogroup Ad",cmd:"kga_shortcode",image:t+"/../images/icon_color.png"}),e.addCommand("kga_shortcode",function(){var t=o(".kga-editor-spinner");if(t.length)t.show();else{var a=o(".mce-container-body");t=o("<div></div>").addClass("kga-editor-spinner").attr("style","position: absolute; left: "+(a.offset().left+a.width()/2-35)+"px; top: "+a.offset().top+"px;").html('<div class="kga-spinner"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div>'),o("body").append(t)}o.ajax({url:ajaxurl,type:"post",data:{action:"kga_getads"},success:function(t){if(o(".kga-editor-spinner").hide(),Array.isArray(t.ads)&&t.ads.length){var a=t.ads.map(function(e){return{value:e.id,text:e.name+" ("+e.id+")"}});e.windowManager.open({title:"Insert a shortcode for a Kelkoo group Ad",body:[{type:"listbox",name:"id",label:"The Ad id",values:a},{type:"textbox",name:"keywords",label:"Some keywords",placeholder:"Enter here one or more keywords"}],onsubmit:function(o){if(!o.data.keywords)return e.windowManager.alert("Please enter one or more keywords"),!1;var t=null!==o.data.id&&""!=o.data.id?' id="'+o.data.id+'"':"",a=' kw="'+o.data.keywords.replace('"'," ")+'"';e.insertContent("[kelkoogroup_ad"+t+a+" /]")}})}else e.windowManager.open({title:"sorry, error while fetching available ads...",body:[{name:"no",type:"textbox",value:"Be sure you have correctly filled your settings",heigth:25}],onsubmit:function(o){e.insertContent("")}})},error:function(){o(".kga-editor-spinner").hide(),e.windowManager.open({title:"sorry, error while fetching available ads...",onsubmit:function(o){e.insertContent("")}})}})})})}(window.tinymce,jQuery);