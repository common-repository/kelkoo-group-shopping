!function(t,a){var e=function(){};e.prototype.init=function(a){this.el=a,this.$el=t(a),this.ads=[],this.body=this.$el.find("tbody"),this.translations=this.$el.data("translations"),this.sortParam="id";var e=this;t.ajax({url:ajaxurl,type:"post",data:{action:"kga_getads"}}).done(function(t){e.ads=t.ads,e.country=t.country,e.trackingId=t.trackingId,e.render()}).error(function(){t.proxy(e.message(e.translations["ws-error"]),e)}),this.$el.find("thead th[data-id]").click(t.proxy(this.changeSortOrder,this))},e.prototype.message=function(a){this.$el.parent().append(t("<alert></alert>").addClass("alert warning").text(a))},e.prototype.changeSortOrder=function(a){var e=t(a.currentTarget),i="-"===this.sortParam[0]?this.sortParam.substr(1):this.sortParam,s=0===this.sortParam.indexOf(e.data("id"));this.$el.find("thead .sortable[data-id="+i+"] .fa").removeClass().addClass("fa fa-sort"),this.sortParam=s?"-"+e.data("id"):e.data("id");var d=s?"fa-sort-desc":"fa-sort-asc";e.find(".fa").removeClass().addClass("fa "+d),this.render()},e.prototype.render=function(){var a,e,i,s,d=[];if(this.body.html(""),this.ads.length){var r=this.ads;r.sort(this.sort(this.sortParam));for(var o=0;o<r.length;o++){d=[],r[o].name?d.push(t("<td></td>").text(r[o].name)):d.push(t("<td></td>").append(t("<i></i>").attr("style","color: #AAA;").text("noname"))),d.push(t("<td></td>").text(r[o].id)),i=this.translations.templateId[r[o].templateId]?this.translations.templateId[r[o].templateId]:r[o].templateId,d.push(t("<td></td>").text(i)),s=this.translations.templateSize[r[o].templateSize]?this.translations.templateSize[r[o].templateSize]:r[o].templateSize,d.push(t("<td></td>").text(s));var n="[kelkoogroup_ad id=&quot;"+r[o].id+"&quot; kw=&quot;iphone&quot; /]";d.push(t("<td></td>").addClass("shortcode").html('<input type="text" onfocus="this.select();" readonly="readonly" value="'+n+'" >')),e=t("<input></input>").attr("id","preview-ad-"+r[o].id).attr("type","button").attr("value","Preview Ad").addClass("button button-primary"),d.push(t("<td></td>").addClass("preview-ad").append(e)),a=t("<tr></tr>").attr({id:"ad-"+r[o].id,"data-id":r[o].id,"data-template-id":r[o].templateId}),a.append(d[0],d[1],d[2],d[3],d[4],d[5]),this.body.append(a)}this.body.find(".preview-ad").click(t.proxy(this.previewAd,this))}else t.proxy(this.message(this.translations["no-ads"]),this)},e.prototype.sort=function(t){var a=1;return"-"===t[0]&&(a=-1,t=t.substr(1)),function(e,i){return(e[t]<i[t]?-1:e[t]>i[t]?1:0)*a}},e.prototype.previewAd=function(a){var e=t(a.currentTarget),i=this,s=e.parent().data("id"),d=e.parent().data("template-id"),r=this.ads.filter(function(t){return t.id==s})[0],o=t(document).height()-e.offset().top<400?400:20,n=t(".ad-builder-page").width()>1e3?300:50,l=t(".existing-ads .js-kga-modal"),p="dynamic"===d?"min-width:500px":"";0===l.length?(l=t("<div></div>").addClass("kga-modal js-kga-modal").attr("style","top: -1000px; left: "+n+"px;"),l.animate({top:e.offset().top-o+"px"},700)):(l.width("auto"),l.height("auto"),l.offset().top<0&&l.animate({top:e.offset().top-o+"px"},700)),l.html('<div class="kga-modal-head"><span class="close"><i class="fa fa-times" aria-hidden="true"></i></span><h3>'+r.name+'</h3></div><div class="kga-modal-body" style="'+p+'"><div class="js-kelkoo-widget" data-kw-country="'+this.country+'" data-kw-tracking-id="'+this.trackingId+'" data-kw-ad-id="'+r.id+'" data-kw-keyword="iphone" ><div class="kga-spinner"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div></div>'),t(".existing-ads").append(l),l.draggable(),l.find(".close").click(function(){i.closeModal(l,n)});var h=kw.widgets.length;h>1&&kw.widgets.splice(h-1,1),kw.widgets.push(new kw.Widget(l.find(".js-kelkoo-widget")[0]))},e.prototype.closeModal=function(a,e){a=a||t(".existing-ads .js-kga-modal"),e=e||t(".ad-builder-page").width()>1e3?300:50,a.animate({left:"-1000px"},1e3,function(){a.attr("style","top: -1000px; left: "+e+"px;")})},e.prototype.add=function(a){this.ads.push(a),this.render();var e=this.$el.find("#ad-"+a.id);t("html, body").animate({scrollTop:e.offset().top},2e3),e.addClass("highlight"),e.on("hover",function(){t(event.currentTarget).removeClass("highlight")})},a.kelkoo_group_shopping.ExistingAds=e}(jQuery,window);